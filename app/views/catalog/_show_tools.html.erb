<script type="text/javascript">
$(document).on('ready page:load', function(){

  $(".mstone-checkbox").on("click", function (){
    // alert("checkbox clicked");
    $(".mstone-form").submit();
  });

    $(".objtv-checkbox").on("click", function (){
    // alert("checkbox clicked");
    $(".objtv-form").submit();
  });
});
</script>

<% 
access_level = check_current_access
super_or_admin = (access_level == 0 || access_level == 1) ? true : false
disable_str = super_or_admin ? " " : "disabled"

mstones  = Milestone.where("card_id='" + @document.id + "'")
comments = Comment.where("card_id='" + @document.id + "'")
objectives = Objective.where("card_id='" + @document.id + "'")
%>

<div class="card show-tools" style="margin-top: 100px;">
    <div class="card-header mstones">
      <h2 class="mb-0 h6 d-inline-block">Milestones:</h2>
    </div>

    <%# List milestones for this card %>
    <ul class="list-group list-group-flush">

      <% if mstones.first.nil?%>
        <li class="list-group-item">
          <em>No milestones</em>
        </li>
      <% else %>
        <% mstones.each do |stone| %>
          <li class="list-group-item">
            <%= form_tag("update_milestone_check", :enctype =>"multipart/form-data", :class => "mstone-form", :method => :post ) do %>
              <div class="form-check pl-0" >
                <label class="checkbox-inline">
                  <% chk_status = (stone.status == 1) ? "checked" : "" %>
                  <input type="hidden" id="mstone_id" name="mstone_id" value=<%= stone.id %> />
                  <input type="hidden" id="mstone_milestone" name="mstone_milestone" value=<%= stone.milestone %> />
                 <input type="checkbox" class="mstone-checkbox" value="status" <%= chk_status %> <%= disable_str %> >  <%= stone.milestone %>
                </label>
              </div>
            <% end %>
          </li>
        <% end %>
      <% end %>

        <%# if super or admin allow adding of items %>
        <% if super_or_admin %>
          <!--Material textarea-->
          <%= form_tag("add_milestone", :enctype =>"multipart/form-data", :method => :post ) do %>
            <li class="list-group-item">
              <div class="mstone-entry-group">
                <div class="md-form form-group purple-border">
                  <input type="hidden" id="card_id" name="card_id" value=<%= @document.id %> />
                  <input type="hidden" id="in_cycle" name="in_cycle" value=<%= @document["in_cycle_ssi"] %>  />
                  <input type="hidden" id="recorded_on" name="recorded_on" value=<%= Date.today %>  />
                  <label for="mstone">New milestone</label>
                  <input type="text" id="mstone" name="mstone" class="form-control" />

                  <label class="checkbox-inline">
                  <input type="checkbox" id="status" name="status">  Already done</label>
                </div>
              </div>
            <button type="submit" class="btn btn-outline-secondary btn-sm d-inline-block add-milestone">Save</button></li>
          <% end %>
        <% end %>

    </ul>

</div>

<div class="card show-tools" style="margin-top: 30px;">
    <div class="card-header comments">
      <h2 class="mb-0 h6 d-inline-block">Comments:</h2>
    </div>
     
    <%# List comments for this card %>
    <ul class="list-group list-group-flush">

      <% if comments.first.nil?%>
        <li class="list-group-item">
          <em>No comments</em>
        </li>
      <% else %>
        <% comments.each do |comm| %>
          <li class="list-group-item">
            <%= comm.comment_txt%>
          </li>
        <% end %>
        <% end %>

        <%# if super or admin allow adding of items %>
        <% if super_or_admin %>
          <!--Material textarea-->
          <%= form_tag("add_comment", :enctype =>"multipart/form-data", :method => :post ) do %>
            <li class="list-group-item">
              <div class="comment-entry-group">
                <div class="md-form form-group purple-border">
                  <input type="hidden" id="card_id" name="card_id" value=<%= @document.id %> />
                  <input type="hidden" id="uemail" name="uemail" value=<%= @document["uemail"] %>  />
                  <input type="hidden" id="recorded_on" name="recorded_on" value=<%= Date.today %>  />
                  <label for="comment_txt">New comment</label>
                  <input type="text" id="comment_txt" name="comment_txt" class="form-control" />
                </div>
              </div>
            <button type="submit" class="btn btn-outline-secondary btn-sm d-inline-block add-comment">Save</button></li>
          <% end %>
        <% end %>
     
    </ul>
</div>

<div class="card show-tools" style="margin-top: 30px;">
    <div class="card-header objectives">
      <h2 class="mb-0 h6 d-inline-block">Objectives:</h2>
    </div>
     
    <%# List comments for this card %>
    <ul class="list-group list-group-flush">

      <% if objectives.first.nil?%>
        <li class="list-group-item">
          <em>No objectives</em>
        </li>
      <% else %>
        <% objectives.each do |objtv| %>
          <li class="list-group-item">
            <%= form_tag("update_objective_check", :enctype =>"multipart/form-data", :class => "objtv-form", :method => :post ) do %>
              <div class="form-check pl-0" >
                <label class="checkbox-inline">
                  <% chk_status = (objtv.status == 1) ? "checked" : "" %>
                  <input type="hidden" id="mstone_id" name="mstone_id" value=<%= objtv.id %> />
                  <input type="hidden" id="objtv_objective" name="objtv_objective" value=<%= objtv.objective %> />
                 <input type="checkbox" class="objtv-checkbox" value="status" <%= chk_status %> <%= disable_str %> >  <%= objtv.objective %>
                </label>
              </div>
            <% end %>
          </li>
        <% end %>
      <% end %>

        <%# if super or admin allow adding of items %>
        <% if super_or_admin %>
          <!--Material textarea-->
          <%= form_tag("add_objective", :enctype =>"multipart/form-data", :method => :post ) do %>
            <li class="list-group-item">
              <div class="objective-entry-group">
                <div class="md-form form-group purple-border">
                  <input type="hidden" id="card_id" name="card_id" value=<%= @document.id %> />
                  <input type="hidden" id="cycle" name="cycle" value=<%= @document["in_cycle_ssi"] %>  />
                  <input type="hidden" id="recorded_on" name="recorded_on" value=<%= Date.today %>  />
                  <label for="objective">New objective</label>
                  <input type="text" id="objective" name="objective" class="form-control" />
                </div>
              </div>
            <button type="submit" class="btn btn-outline-secondary btn-sm d-inline-block add-comment">Save</button></li>
          <% end %>
        <% end %>

    </ul>

</div>
