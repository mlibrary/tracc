<% color1 = "" #neutral 100
   color2 = "" #blue-300

   color3 = "#FFF" 
   color4 = "#CCC"
    

  @slist = Card.where("activity_type LIKE 'Strategic'")
  @alist = Card.where("activity_type LIKE '%Active%' ")   

  total_chips = Chip.sum(:project) *1.00

 flag = true

nameofmonths = ['','Jan', 'Feb','March','April','May','June','July','Aug', 'Sep','Oct','Nov','Dec']

cur_cycle = Cycle.where("current_cycle =1")
cycle = cur_cycle.first.cycle_name
s = cur_cycle.first.start.month
stmonth = ""
endmonth = ""

if (s != nil)
  stmonth = nameofmonths[s]
  if s<=8
    s = s +3
  else
    s = s+3 -12 
  end  
  endmonth = nameofmonths[s]
end 

s = cur_cycle.first.start.month

months = ['','','','','']
i = 1
while (i<=4) do
  months[i] = nameofmonths[s]
  i = i + 1
  s = s+1 
  if (s>12)
    s= 1
  end
end 


chart1 = Gchart.pie_3d(:title => "Total Capacity", :labels => "['one', 'two']", :data => [10,20], :size => '300x200')
chart2 = Gchart.bar(:title => "Project Assignments", :labels => "['one', 'two']", :data => [10,20], :size => '300x200')
chart_pie = Gchart.pie_3d(:title => "Total Capacity", :labels => "['one', 'two']", :data => [10,20], :size => '300x200')

chart4 = Gchart.pie_3d(:title => "Total Capacity", :labels => "['one', 'two']", :data => [10,20], :size => '300x200')
chart5 = Gchart.pie_3d(:title => "Total Capacity", :labels => "['one', 'two']", :data => [10,20], :size => '300x200')

pro = Array.new
cap =Array.new


   @slist.all.each do |strategic| 
           card_id = strategic.id 
           str = "card_id='" + card_id.to_s + "' AND cycle='"+ cycle + "'"
 
           total = 0 
           cnt = 0
           @o_st = Objective.where(str) 

           @o_st.all.each do |o|     
            ostatus = o.status
            cnt = cnt+1 
            if (ostatus != nil)
              total+=ostatus
            end
          end    
          total = total/cnt 
          # capacity
          totalfte = 0 
        
          str = "card_id='" + card_id.to_s + "' AND cycle='"+ cycle + "' "
          @ch_st = ChipAssignment.where(str)

          @ch_st.all.each do |ch| 
            
            if (ch.chips !=nil) 
              fte = ch.chips/4.00
              totalfte = totalfte + fte
             else
              fte = 0 
            end 
          end
          totalfte = totalfte/4

          pro << total
          cap << totalfte
         end
 
            
status_keys = ['Capacity','Progress']
x_labels = ['LSP | CS | LS | DB | DCP | Fulcrum | Website | HT']
title =""
details_data = Gchart.bar( %>
                  <% :size => '600x400', %>
                  <% :bar_colors => '81b0df,adcb62' , %>
                  <% :title => title, %>
                  <% :bg => 'FFFFFF', %>
                  <% :legend => status_keys, %>
                  <% :data => [cap,pro], %>
                  <% :stacked => false, %>
                  <% :legend_position => 'bottom', %>
                  <% :axis_with_labels => [['x'], ['y']], %>
                  <% :max_value => 100, %>
                  <% :min_value => 0, %>
                  <% :bar_width_and_spacing => [50,6], %>
                  <% :axis_labels => x_labels, %>
                  <% ) 

# ---- end of capacity and progress details ------
%>

<div class="container">
<h3  style="padding-bottom: 45px"> <%=cycle%> (<%= stmonth %>-<%= endmonth %>) Library IT Dashboard </h3> 
<div class="panel-group" id="accordion" style="padding-top: 25px">
  <div class="card" style="background: <%=color1 %>">
     <div class="card-header" style="background: <%= color2 %>">
       <h4>
        <a data-toggle="collapse" data-parent="#accordion" href="#collapse1">
        Strategic Projects:  Capacity and Progress </a>
      </h4>
    </div>

    <div id="collapse1" class="panel-collapse collapse in">
    <div class="card-body">
      <div class="row">
          <div class="col-md-9"><%= image_tag details_data%></div>
          
          <div class="col-md-3"> 
              <% 
              i = 0 
              @slist.each do |strategic|
              
             %>
             <p><b><%= strategic.short_name%></b>
              <br>Capacity: <%=cap[i]%> FTE
              <br>Progress: <%=pro[i]%>%
             </p>
             <% 
               i = i + 1   
               end 
            %>
              

          </div>   
      </div>
    </div>
 </div>
 </div>
  

  <div class="card" style="background: <%=color1 %>">
      <div class="card-header" style="background: <%= color2 %>">
       <h4> 
       <a data-toggle="collapse" data-parent="#accordion" href="#collapse2">
        Tactical Projects</a>
      </h4>
    </div>
    <div id="collapse2" class="panel-collapse collapse">
      <div class="card-body">
        <div class="row" style="padding-top: 20px" >
         <%
         a_cnt = 0 
         @alist.all.each do |active| 
           card_id = active.id 

           str = "card_id='" + card_id.to_s + "' AND cycle='"+ cycle + "'"
           @o_st = Objective.where(str) 
           
           if ( @o_st.first != nil)
            total = @o_st.first.status
           else
            total = 0  
           end
           totalfte = 0 
           fte = 0 
           @ch_st = ChipAssignment.where(str)
           @ch_st.all.each do |ch| 
            
            if (ch.chips !=nil) 
              fte = ch.chips/4.00
              totalfte = totalfte + fte
             else
              fte = 0 
            end 
          end
          totalfte = totalfte/4


           a_cnt = a_cnt + 1
           if (a_cnt == 5) 
           a_cnt = 1   
         %>
         </div><div class="row" style="padding-top: 20px" >        
         <% end %>
          <div class="col-md-3">
            <%= active.short_name%>
            <p>Capacity Allocated: <%= totalfte.round(2) %>FTE</p>
            <p>Progress: </p>
              <div class="progress"> <div class="progress-bar bg-info" role="progressbar" style="width: <%=total%>%;" aria-valuenow="<%=total%>" aria-valuemin="0" aria-valuemax="100"> <%=total%>%
          </div> </div>
         </div>
         <% end %> 
         </div> 
      </div>
    </div>
  </div>

</div>  
<%
 ch = Chip.order(:dept)
 totalfte = 0 
 ch.each do |t|
  totalfte = totalfte = totalfte + t.ops*1.0/4
 end
%>
  <div class="card" style="background: <%=color1 %>">
      <div class="card-header" style="background: <%= color2 %>">
      <h4 >
        <a data-toggle="collapse" data-parent="#accordion" href="#collapse3">
        LIT Capacity </a>
      </h4>
    </div>
    <div id="collapse3" class="panel-collapse collapse">
      <div class="card-body">
        <% 
            flag = true
              
         %>  
        <h5>Total FTE: <%=totalfte %></h5>
        
          

      </div>
    </div>
  </div>
</div>
</div>